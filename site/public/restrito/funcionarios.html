<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../resources/css/funcionarios_style.css">
    <link rel="stylesheet" href="../resources/css/menu_dash.css">
    <link rel="stylesheet" href="../resources/css/bot.css">
    <link rel="icon" href="../resources/img/LogoEyeMarketFundoBranco.jpg">
    <title>Dashboard | Funcionários</title>
</head>

<body>
    <div class="bot_help" id="bot_help">
        <div class="bot_header">

            <div class="nomeBot">
                Suporte | EyeMarket
            </div>

            <div class="bot_sair" onclick="fecharBot()">
                X
            </div>
        </div>

        <div class="mensagens">
            <div class="mensagem_bot" id="msgFirst">
                <div class="perfil_bot">
                    <img src="../resources/img/robo.png" alt="">
                </div>
                <div class="msg">
                    Olá &#128075; , no que posso ajudar?
                </div>
            </div>
            <div class="escolha" id="escolha">
                Escolha uma opção abaixo

                <div class="opcao" onclick="opcao1()">
                    Problema com o site web
                </div>

                <div class="opcao" onclick="opcao2()">
                    Problema com a aplicação no totem
                </div>
            </div>

            <div class="mensagem_bot" id="opcaoOne">
                <div class="perfil_bot">
                    <img src="../resouces/img/robo.png" alt="">
                </div>
                <div class="msg">
                    &#128071; Segue abaixo um PDF com os principais problemas e soluções! Caso ainda não tenha resolvido
                    seu problema clique em <b>"Contatar Suporte"</b>
                </div>
            </div>

            <div class="escolha" id="escolha2" style="display: none;">
                Escolha uma opção abaixo

                <div class="opcao">
                    &#128229; <a href="../resources/pdf/EMsuporte-site.pdf">Baixar PDF</a>
                </div>

                <a href="helpdesk.html">
                    <div class="opcao">
                        &#9993; Contatar suporte
                    </div>
                </a>

                <div class="opcao" onclick="voltar()">
                    &#128281; Voltar
                </div>
            </div>


            <div class="mensagem_bot" id="opcaoTwo">
                <div class="perfil_bot">
                    <img src="../resources/img/robo.png" alt="">
                </div>
                <div class="msg">
                    &#128071; Segue abaixo um PDF com os principais problemas e soluções! Caso ainda não tenha resolvido
                    seu problema clique em <b>"Contatar Suporte"</b>
                </div>
            </div>

            <div class="escolha" id="escolha3" style="display: none;">
                Escolha uma opção abaixo

                <div class="opcao">
                    &#128229; <a href="../resources/pdf/EMsuporte-totem.pdf">Baixar PDF</a>
                </div>

                <a href="helpdesk.html">
                    <div class="opcao">
                        &#9993; Contatar suporte
                    </div>
                </a>

                <div class="opcao" onclick="voltar()">
                    &#128281; Voltar
                </div>
            </div>
        </div>
    </div>
    <div id="cadastro" class="cadastro">
        <div class="tela_cadastro">
            <div class="header_cadastro">
                <div class="cadastro_up">
                    <div class="title">Cadastro funcionário</div>
                    <div class="line"></div>
                </div>

                <div class="cadastro_down">
                    <div class="text">Cadastre um novo funcionário no sistema</div>
                </div>
            </div>

            <div class="main_cadastro">
                <div class="label">Nome completo:</div>
                <input id="iptNome" class="inptInteiro" type="text">

                <div class="label">E-mail:</div>
                <input id="iptEmail" class="inptInteiro" type="text">

                <div class="label">Telefone:</div>
                <input id="iptTelefone" class="inptInteiro" type="text">

                <div class="label">Cargo:</div>
                <select name="" id="scargo">
                    <option value="supervisor">Supervisor</option>
                    <option value="tecnico">Técnico</option>
                </select>

                <div class="passwords">
                    <div class="password">
                        <div class="label">Senha:</div>
                        <input id="iptSenha" class="inptMeio" type="password">
                    </div>
                    <div class="password">
                        <div class="label">Repita a senha:</div>
                        <input id="iptSenhaConfirmar" class="inptMeio" type="password">
                    </div>
                </div>

                <div class="btns">
                    <button class="cancelar" onclick="cancelarCadastro()">Cancelar</button>
                    <button class="cadastrar" onclick="cadastrarFuncionario()">Cadastrar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="inativar" id="inativar">
        <div class="tela_inativar">
            <div class="header_inativar">
                <div class="texts">
                    <div class="title">Inativar funcionário</div>
                    <div class="subtitle">Você tem certeza de que desejar inativar esse funcionário?</div>
                </div>
                <img src="../resources/img/triste.png" alt="">
            </div>

            <div class="btns">
                <button class="cancelar" onclick="cancelarInativo()">Cancelar</button>
                <button class="cadastrar" onclick="inativarFuncionario()">Inativar</button>
            </div>
        </div>
    </div>
    <div class="menu_dash">
        <a href="index_restrita.html">
            <div class="icon" aria-label="Home"><img src="../resources/img/silhueta_casa.png" /></div>
        </a>
        <div class="mid">
            <div class="atv_icon" aria-label="Funcionários"><img src="../resources/img/silhueta_user.png" /></div>
            <a href="graficos.html">
                <div class="icon" aria-label="Gráficos"><img src="../resources/img/silhueta_grafico.png" /></div>
            </a>
            <a href="calendario.html">
                <div class="icon" aria-label="Calendário"><img src="../resources/img/silhueta_calendario.png" /></div>
            </a>
            <a href="Totens.html">
                <div class="icon" aria-label="Totens"><img src="../resources/img/silhueta_totem.png" /></div>
            </a>
        </div>
        <div class="bot">
            <div class="icon" aria-label="Suporte" onclick="abrirBot()"><img
                    src="../resources/img/silhueta_apoio.png" /></div>
            <div class="icon_sair" aria-label="Sair" onclick="sair()"><img src="../resources/img/silhueta_sair.png" />
            </div>
        </div>
    </div>

    <div class="main">
        <div class="header">
            <div class="title">Supervisores | Técnicos</div>
            <div class="subtitle">Lista de todos os supervisores e técnicos do mercado que utilizam o sistema</div>
        </div>

        <div class="search">
            <div class="busca">
                <input id="iptBusca" placeholder="Buscar funcionários..." type="text">
                <img src="../resources/img/lupa.png" onclick="buscarFuncionarioPorNome()">
            </div>
            <div class="btn" onclick="abrirCadastrar()">
                <img src="../resources/img/adicionar-contato.png">
            </div>
        </div>

        <div class="filtro">
            <button class="escolhaFuncionario" onclick="buscarFuncionarios('Técnico')">
                <div class="opc_atv" id="tecnico">Visualizar apenas Técnicos</div>
            </button>
            <button class="escolhaFuncionario" onclick="buscarFuncionarios('Supervisor')">
                <div class="opc" id="supervisor">Visualizar apenas Supervisores</div>
            </button>
            <button class="escolhaFuncionario" onclick="buscarFuncionarios('todos')">
                <div class="opc" id="todos">Visualizar todos</div>
            </button>
        </div>

        <table id="funcionarios">
            <tr class='titulo'>
                <th>Cargo</th>
                <th>Nome</th>
                <th>Telefone</th>
                <th>Editar</th>
                <th>Inativar</th>
            </tr>
        </table>
    </div>
</body>

</html>

<script>

    var escolhaInativo = 0;

    window.onload = buscarFuncionarios('todos');

    function buscarFuncionarios(cargo) {
        if (cargo == 'Técnico') {
            tecnico.style.fontWeight = 'bold';
            supervisor.style.fontWeight = 'normal';
            todos.style.fontWeight = 'normal';
        } else if (cargo == 'Supervisor') {
            supervisor.style.fontWeight = 'bold';
            tecnico.style.fontWeight = 'normal';
            todos.style.fontWeight = 'normal';
        } else {
            todos.style.fontWeight = 'bold';
            tecnico.style.fontWeight = 'normal';
            supervisor.style.fontWeight = 'normal';
        }
        console.log("Entrou aqui 1");
        fetch(`/usuarios/listar/${cargo}`, { cache: "no-store" })
            .then(function (response) {
                console.log("Entrou aqui 2");
                if (response.status == 200) {
                    console.log("Entrou aqui 3");
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                        funcionarios.innerHTML = "<tr class='titulo'> <th>Cargo</th> <th>Nome</th> <th>Telefone</th> <th>Editar</th> <th>Inativar</th> </tr>";
                        for (i = 0; i < resposta.length; i++) {
                            var registro = resposta[i];
                            funcionarios.innerHTML += `<tr> <td class='cargo'>${registro.Cargo}</td> <td>${registro.NomeCompleto}</td> <td>${registro.Telefone}</td> <td><a href='updateFuncionario.html?id=${registro.IDUsuario}'><img src='../resources/img/editar-texto.png' /></a></td> <td><img src='../resources/img/desativado.png' onclick='abrirInativo(${registro.IDUsuario})' /></td> </tr>`;

                        }
                        // plotarGrafico(resposta, idAquario);
                    });
                } else {
                    console.error("Nenhum dado encontrado ou erro na API");
                }
            })
            .catch(function (error) {
                console.error(
                    `Erro na obtenção dos dados p/ gráfico: ${error.message}`
                );
            });
    }

    function buscarFuncionarioPorNome(){
        var nome = iptBusca.value;
        if(nome == ""){
            buscarFuncionarios('todos');
        }
        tecnico.style.fontWeight = 'normal';
        todos.style.fontWeight = 'normal';
        supervisor.style.fontWeight = 'normal';
        fetch(`/usuarios/listarNome/${nome}`, { cache: "no-store" })
            .then(function (response) {
                console.log("Entrou aqui 2");
                if (response.status == 200) {
                    console.log("Entrou aqui 3");
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                        funcionarios.innerHTML = "<tr class='titulo'> <th>Cargo</th> <th>Nome</th> <th>Telefone</th> <th>Editar</th> <th>Inativar</th> </tr>";
                        for (i = 0; i < resposta.length; i++) {
                            var registro = resposta[i];
                            funcionarios.innerHTML += `<tr> <td class='cargo'>${registro.Cargo}</td> <td>${registro.NomeCompleto}</td> <td>${registro.Telefone}</td> <td><a href='updateFuncionario.html?id=${registro.IDUsuario}'><img src='../resources/img/editar-texto.png' /></a></td> <td><img src='../resources/img/desativado.png' onclick='abrirInativo(${registro.IDUsuario})' /></td> </tr>`;

                        }
                        // plotarGrafico(resposta, idAquario);
                    });
                } else {
                    console.error("Nenhum dado encontrado ou erro na API");
                }
            })
            .catch(function (error) {
                console.error(
                    `Erro na obtenção dos dados p/ gráfico: ${error.message}`
                );
            });
    }

</script>


<script>
    function cadastrarFuncionario() {
        var nomeVar = iptNome.value;

        var select = document.getElementById("scargo");
        var opcaoTexto = select.options[select.selectedIndex].text;

        var emailVar = iptEmail.value;
        var telefoneVar = iptTelefone.value;
        var senhaVar = iptSenha.value;
        var confirmacaoSenhaVar = iptSenhaConfirmar.value;


        console.log(nomeVar, opcaoTexto, emailVar, telefoneVar, senhaVar);

        if (nomeVar == "" || emailVar == "" || senhaVar == "" || confirmacaoSenhaVar == "") {

            alert("Preencha todos os campos para prosseguir!");
            return false;
        }

        // Nome numérico
        var nome = Number(nomeVar);

        if (!isNaN(nome)) {

            // alert("Nome não pode ser numérico, digite seu nome novamente");
            alert("Nome não pode ser numérico");

            return false;
        }

        if (senhaVar.length < 4) {

            alert("Senha deve conter no mínimo 4 caracteres");
            return false;
        }

        // Email com @ e .com
        if (emailVar.indexOf("@") == -1 || emailVar.indexOf(".com") == -1) {

            alert("E-mail inválido");

            return false;
        }

        // Campo confirmacaoSenha igual ao de senha
        if (senhaVar != confirmacaoSenhaVar) {

            alert("As senhas não são iguais");

            return false;
        }

        fetch("/usuarios/cadastrarFuncionario", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                cargoServer: opcaoTexto,
                emailServer: emailVar,
                senhaServer: senhaVar,
                telefoneServer: telefoneVar

            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                cancelarCadastro();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);

        });

    }
</script>

<script>
    function abrirCadastrar() {
        cadastro.style.display = 'flex';
    }

    function cancelarCadastro() {
        cadastro.style.display = 'none';
    }

    function abrirInativo(id) {
        inativar.style.display = 'flex'
        escolhaInativo = id;
    }

    function cancelarInativo() {
        inativar.style.display = 'none'
    }

    function inativarFuncionario(){
        cancelarInativo();
        location.reload();
        console.log(escolhaInativo);
        fetch(`/usuarios/inativar/${escolhaInativo}`, { cache: "no-store" })
            .then(function (response) {
            })
            .catch(function (error) {
                console.error(
                    `Erro ao inativar: ${error.message}`
                );
            });
    }
</script>

<script src="../resources/js/bot.js"></script>



<script>
    function sair() {
        sessionStorage.clear();
        window.location.replace('../index.html');
    }
</script>